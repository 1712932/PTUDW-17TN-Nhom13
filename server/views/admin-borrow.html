{% extends "admin-layout.html" %}

{% macro borrowCardRow(card) %}
  <tr>
    <td>{{card.status}}</td>
    <td>{{card.book.title}}</td>
    <td>{{card.book.bookCount}}</td>
    <td>{{card.user.username}}</td>
    <td>{{card.createdAt}}</td>
    <td>
      {% if (card.status | isBorrowConfirmable) %}
      <form class="borrow-form" action="borrow/quick/{{card.id}}?_method=PUT" method="post">
        <button type="submit" class="action-btn text-navy">
          <i class="fa fa-check-circle-o" aria-hidden="true" style="font-size: 20px;margin-left: 5px"></i>
        </button>
      </form>
      {% else %}
        <i class="fa fa-check-circle-o invisible-button" aria-hidden="true" style="margin-left: 5px"></i>
      {% endif %}

      {% if (card.status | isCanceled) === false %}
      <form class="borrow-form" action="borrow/{{card.id}}?_method=DELETE" method="post">
        <button type="submit" class="action-btn text-danger" style="margin-left: 15px" onclick="return confirm('Bạn có chắc không?')">
          <i class="fa fa-trash-o" aria-hidden="true" style="font-size: 20px"></i>
        </button>
      </form>
      {% else %}
        <i class="fa fa-check-circle-o invisible-button" aria-hidden="true" style="margin-left: 15px"></i>
      {% endif %}

      <a href="borrow/edit/{{card.id}}">
        <button type="button" class="action-btn text-navy" style="margin-left: 15px">
          <i class="fa fa-pencil-square-o" aria-hidden="true" style="font-size: 20px"></i>
        </button>
      </a>
    </td>
  </tr>
{% endmacro %}

{% macro borrowCardHeader() %}
  <tr>
    <th>Tình trạng</th>
    <th>Tựa sách</th>
    <th>Số sách</th>
    <th>Username</th>
    <th>Ngày tạo</th>
    <th></th>
  </tr>
{% endmacro %}

{% macro borrowCardTable(borrowCards) %}
  <thead>
    {{borrowCardHeader()}}
  </thead>
  {% for card in borrowCards %}
    {{borrowCardRow(card)}}
  {% endfor %}
  <tfoot>
    {{borrowCardHeader()}}
  </tfoot>
{% endmacro %}

{% block breadcrumb %}
<div class="col-lg-10">
  <h2>Quản lý thẻ mượn</h2>
  <ol class="breadcrumb">
    <li>
      <a href="/admin">Trang chủ</a>
    </li>
    <li class="active">
      <strong>Quản lý thẻ mượn</strong>
    </li>
  </ol>
</div>
{% endblock %}

{% block style %}
<style>
  .borrow-form {
    display: inline-block;
  }
  .action-btn {
    background-color: transparent;
    border: none;
    padding: 0;
  }
  .invisible-button {
    font-size: 20px; 
    visibility: hidden;
  }
</style>
{% endblock %}

{% block body %}
<div class="row">
  <div class="col-lg-12">
    <div class="ibox float-e-margins">
      <div class="ibox-title">
        <h5>Danh sách các thẻ mượn trong thư viện</h5>
        <div class="ibox-tools">
          <a class="collapse-link">
            <i class="fa fa-chevron-up"></i>
          </a>
          <a class="close-link">
            <i class="fa fa-times"></i>
          </a>
        </div>
      </div>
      <div class="ibox-content">
        <div class="table-responsive">
          <table id="borrow-table" class="table table-striped table-bordered table-hover">
            {{ borrowCardTable(borrowCards) }}
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  $(document).ready(function() {
    $("#borrow-table").DataTable({
      pageLength: 10,
      responsive: true,
      dom: '<"html5buttons"B>lTfgitp',
      buttons: [{
          extend: "copy"
        },
        {
          extend: "csv"
        },
        {
          extend: "excel",
          title: "ExampleFile"
        },
        {
          extend: "pdf",
          title: "ExampleFile"
        },
        {
          extend: "print",
          customize: function(win) {
            $(win.document.body).addClass("white-bg");
            $(win.document.body).css("font-size", "10px");

            $(win.document.body)
              .find("table")
              .addClass("compact")
              .css("font-size", "inherit");
          }
        }
      ],
      "columnDefs": [ 
        {
          "targets": -1,
          "orderable": false,
        },
        {
          "targets": -1,
          "width": "8%",
        },
      ],
    });
  });
</script>
{% endblock %}